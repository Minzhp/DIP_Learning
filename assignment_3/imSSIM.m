function [SSIM] = imSSIM(I1, I2)
I1 = double(I1);
I2 = double(I2);
k1 = 0.01;
k2 = 0.03;
L = 2 ^ 8 - 1;
c1 = (k1 * L) ^ 2;
c2 = (k2 * L) ^ 2;
u1 = mean(I1, 'all');
u2 = mean(I2, 'all');
sigma2_1 = mean((I1 - u1) .^ 2, 'all');
sigma2_2 = mean((I2 - u2) .^ 2, 'all');
sigma_12 = mean((I1 - u1) .* (I2 - u2), 'all');
SSIM = ((2 * u1 * u2 + c1) * (sigma_12 * 2 + c2)) / ((u1 ^ 2 + u2 ^ 2 + c1) * (sigma2_1 + sigma2_2 + c2));

% I1 = double(I1);
% I2 = double(I2);
% k1 = 0.01;
% k2 = 0.03;
% L = 2 ^ 8 - 1;
% C1 = (k1 * L) ^ 2;
% C2 = (k2 * L) ^ 2;
% C3 = C2 / 2; 
% mu1 = mean(I1, 'all');
% mu2 = mean(I2, 'all');
% sigma1 = sqrt(mean((I1 - mu1) .^ 2, 'all'));
% sigma2 = sqrt(mean((I2 - mu1) .^ 2, 'all'));
% sigma12 = mean((I1 - mu1) .* (I2 - mu2), 'all');
% l12 = (2 * mu1 * mu2 + C1) / (mu1 ^ 2 + mu2 ^ 2 + C1);
% c12 = (2 * sigma1 * sigma2 + C2) / (sigma1 ^ 2 + sigma2 ^ 2 + C2);
% s12 = (sigma12 + C3) / (sigma1 * sigma2 + C3);
% SSIM = l12 * c12 * s12;